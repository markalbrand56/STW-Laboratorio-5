<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Chat</title>
</head>
<body>
    <script type="application/javascript">
        const messages_display = document.createElement('ul')

        const Message = (text, user) => {
            const element = document.createElement('div')
            const user_element = document.createElement('span')

            element.append(user_element)
            user_element.append(user)

            if (text.endsWith('.jpg') || text.endsWith('.png') || text.endsWith('.gif')) {
                const image = document.createElement('img')
                image.src = text
                image.style.width = '100%'
                image.style.maxWidth = '500px'
                // error para cargar imagen
                image.onerror = () => {
                    console.log(text)
                    image.src = 'https://w7.pngwing.com/pngs/285/84/png-transparent-computer-icons-error-super-8-film-angle-triangle-computer-icons.png'
                }
                element.append(image)
            }else if (text.endsWith('.mp4')) {
                const video = document.createElement('video')
                video.src = text
                video.style.width = '100%'
                video.style.maxWidth = '500px'
                video.controls = true
                element.append(video)
            }else if (text.startsWith('http') || text.startsWith('www') || text.startsWith('https')) {
                const link = document.createElement('a')
                link.href = text
                link.append(text)
                element.append(link)
            }else {
                const text_element = document.createElement('span')
                element.append(text_element)
                text_element.append(text)
                text_element.style.wordBreak = 'break-all'  // Ajustar textos largos a la pantalla

            }

            element.style.display = 'flex'
            element.style.padding = '5px'
            //element.style.marginLeft = '10px'
            element.style.marginRight = '10px'
            element.style.flexDirection = 'column'
            user_element.style.fontWeight = 'bold'

            if (user === 'MarkAlbrand56') {  // Usuario de este chat
                element.style.alignItems = 'flex-end'
            } else {
                element.style.alignItems = 'flex-start'
            }

            return element
        }
        const getMessages = async () => {
            const response = await fetch('http://uvgenios.online/api/messages')
            const messages = await response.json()
            console.log("a")

            const list_messages = messages.map((message) => {
                return Message(message.text, message.user)
            })
            list_messages.forEach((li) => messages_display.append(li))
        }
        getMessages()
        const form = document.createElement('form')
        const input = document.createElement('input')
        const button = document.createElement('button')

        button.append('SEND')
        form.append(input)
        form.append(button)

        form.style.width = '100%'
        form.style.display = 'flex'
        form.style.justifyContent = 'center'
        input.style.width = '100%'
        input.style.maxWidth = '500px'
        input.style.marginRight = '10px'
        input.style.padding = '10px'
        input.style.fontSize = '20px'

        document.body.append(messages_display)
        document.body.append(form)
    </script>
</body>
</html>